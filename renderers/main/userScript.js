/*! For license information please see userScript.js.LICENSE.txt */
(()=>{var e={709:function(e,t){var o,n;void 0===(n="function"==typeof(o=function(){var e=function e(t){function o(e,t){return e>>>t|e<<32-t}for(var n,r,s=Math.pow,i=s(2,32),a="",l=[],c=8*t.length,d=e.h=e.h||[],u=e.k=e.k||[],v=u.length,h={},f=2;v<64;f++)if(!h[f]){for(n=0;n<313;n+=f)h[n]=f;d[v]=s(f,.5)*i|0,u[v++]=s(f,1/3)*i|0}for(t+="";t.length%64-56;)t+="\0";for(n=0;n<t.length;n++){if((r=t.charCodeAt(n))>>8)return;l[n>>2]|=r<<(3-n)%4*8}for(l[l.length]=c/i|0,l[l.length]=c,r=0;r<l.length;){var p=l.slice(r,r+=16),g=d;for(d=d.slice(0,8),n=0;n<64;n++){var m=p[n-15],y=p[n-2],b=d[0],S=d[4],w=d[7]+(o(S,6)^o(S,11)^o(S,25))+(S&d[5]^~S&d[6])+u[n]+(p[n]=n<16?p[n]:p[n-16]+(o(m,7)^o(m,18)^m>>>3)+p[n-7]+(o(y,17)^o(y,19)^y>>>10)|0);(d=[w+((o(b,2)^o(b,13)^o(b,22))+(b&d[1]^b&d[2]^d[1]&d[2]))|0].concat(d))[4]=d[4]+w|0}for(n=0;n<8;n++)d[n]=d[n]+g[n]|0}for(n=0;n<8;n++)for(r=3;r+1;r--){var _=d[n]>>8*r&255;a+=(_<16?0:"")+_.toString(16)}return a};return e.code='var sha256=function a(b){function c(a,b){return a>>>b|a<<32-b}for(var d,e,f=Math.pow,g=f(2,32),h="length",i="",j=[],k=8*b[h],l=a.h=a.h||[],m=a.k=a.k||[],n=m[h],o={},p=2;64>n;p++)if(!o[p]){for(d=0;313>d;d+=p)o[d]=p;l[n]=f(p,.5)*g|0,m[n++]=f(p,1/3)*g|0}for(b+="\\x80";b[h]%64-56;)b+="\\x00";for(d=0;d<b[h];d++){if(e=b.charCodeAt(d),e>>8)return;j[d>>2]|=e<<(3-d)%4*8}for(j[j[h]]=k/g|0,j[j[h]]=k,e=0;e<j[h];){var q=j.slice(e,e+=16),r=l;for(l=l.slice(0,8),d=0;64>d;d++){var s=q[d-15],t=q[d-2],u=l[0],v=l[4],w=l[7]+(c(v,6)^c(v,11)^c(v,25))+(v&l[5]^~v&l[6])+m[d]+(q[d]=16>d?q[d]:q[d-16]+(c(s,7)^c(s,18)^s>>>3)+q[d-7]+(c(t,17)^c(t,19)^t>>>10)|0),x=(c(u,2)^c(u,13)^c(u,22))+(u&l[1]^u&l[2]^l[1]&l[2]);l=[w+x|0].concat(l),l[4]=l[4]+w|0}for(d=0;8>d;d++)l[d]=l[d]+r[d]|0}for(d=0;8>d;d++)for(e=3;e+1;e--){var y=l[d]>>8*e&255;i+=(16>y?0:"")+y.toString(16)}return i};',e})?o.apply(t,[]):o)||(e.exports=n)},761:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BAR_TYPES=t.SPONSOR_BLOCK_API=void 0,t.SPONSOR_BLOCK_API="https://sponsorblock.inf.re/api",t.BAR_TYPES={sponsor:{color:"#00d400",opacity:"0.7",name:"sponsored segment"},intro:{color:"#00ffff",opacity:"0.7",name:"intro"},outro:{color:"#0202ed",opacity:"0.7",name:"outro"},interaction:{color:"#cc00ff",opacity:"0.7",name:"interaction reminder"},selfpromo:{color:"#ffff00",opacity:"0.7",name:"self-promotion"},music_offtopic:{color:"#ff9900",opacity:"0.7",name:"non-music part"}}},269:(e,t,o)=>{"use strict";t.K=void 0;var n=o(951);Object.defineProperty(t,"K",{enumerable:!0,get:function(){return n.run}})},52:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SponsorblockSkipper=void 0;const n=o(204);t.SponsorblockSkipper=class{constructor({video:e,onSkipSegment:t}){this.segments=[],this.setSegments=e=>{this.segments=e},this.onTimeupdateEvent=e=>{const t=.5,o=this.video.currentTime,n=this.segments.filter((({segment:[e,n]})=>e>o-t&&n>o-t)).sort((({segment:[e]},{segment:[t]})=>e-t));if(!n.length)return void console.info(this.videoID,"No more segments",this.segments.length);const[r]=n,[s,i]=r.segment;o-t<=s&&o+t>=s&&(this.video.currentTime=i,console.info(this.videoID,"Skipping",r),this.handleSkipSegment(r))},this.handleSkipSegment=t,this.video=e;const o=(0,n.getVideoId)();if(!o)throw new Error("get videoID failed");this.videoID=o,this.video.addEventListener("timeupdate",this.onTimeupdateEvent)}}},141:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SliderOverlay=void 0;const n=o(761),r=o(290);t.SliderOverlay=class{constructor({video:e}){this.createProgressBar=()=>{const e=document.querySelector(".ytlr-progress-bar");if(!e)throw new Error("progress bar not found");return e},this.createSliderOverlay=()=>{const e=document.querySelector(".ytlr-progress-bar__slider-base"),t=document.querySelector(".ytlr-progress-bar__slider"),o=null!=e?e:t;if(!o)throw new Error("Slider.createSliderOverlay: slider not found");return{slider:o,type:e?r.SliderType.Chapters:r.SliderType.Default}},this.onProgressBarEvent=e=>{if("attributes"!==e.type||"class"!==e.attributeName)throw Error("test if condition");const t=e.target.classList,o=this.slider.classList,n=t.contains("ytlr-progress-bar--has-multi-markers")&&!o.contains("ytlr-progress-bar__slider-base"),r=!t.contains("ytlr-progress-bar--has-multi-markers")&&!o.contains("ytlr-progress-bar__slider");if(n||r)return console.warn("Есть различия со слайдером, ререндер"),void("number"==typeof this.video.duration?this.remount():console.warn("video player lost common props"))},this.onMutationCallback=e=>{for(const t of e)if(t.target.nodeName!==this.progressbar.nodeName){if(t.removedNodes)for(const e of t.removedNodes)e===this.segmentsoverlay&&(console.info("remount overlay"),this.mount())}else this.onProgressBarEvent(t)},this.mount=()=>{this.observer.disconnect(),this.slider.appendChild(this.segmentsoverlay),this.observer.observe(this.slider,{childList:!0}),this.observer.observe(this.progressbar,{attributes:!0,attributeFilter:["class"],attributeOldValue:!0})},this.remount=()=>{this.rebuild(this.segments,!0)},this.unmount=()=>{this.observer.disconnect(),this.clearSegmentOverlay()},this.rebuild=(e,t=!1)=>{if(!e.length)return void console.log("rebuild segments empty");if(!t&&e===this.segments)return void console.log("segments already loaded");const{slider:o,type:n}=this.createSliderOverlay();this.slider=o,this.type=n,this.mount(),this.segments=e,this.clearSegmentOverlay(),this.createSegmentOverlay()},this.clearSegmentOverlay=()=>{try{this.slider.removeChild(this.segmentsoverlay)}catch(e){console.warn("slider remove overlay error",e)}Array.from(this.segmentsoverlay.children).forEach((e=>e.remove())),this.segmentsoverlay.remove()},this.createSegmentOverlay=()=>{const e=this.video.duration;e||console.warn("video duration incorrected",this.video.currentTime),this.segments.forEach((t=>{const[o,s]=t.segment,i=n.BAR_TYPES[t.category];i||console.warn("segment category not mapped",t);const a=null!=i?i:{color:"blue",opacity:.7},l=`translateX(${o/e*100}%) scaleX(${(s-o)/e})`,c=document.createElement("div");this.type===r.SliderType.Chapters?(c.classList.add("ytlr-multi-markers-player-bar-renderer__segment"),c.style.position="absolute"):c.classList.add("ytlr-progress-bar__played"),c.style.background=a.color,c.style.opacity=a.opacity.toString(),c.style.webkitTransform=l,this.segmentsoverlay.appendChild(c)})),console.log("createSegmentOverlay segments",this.segments.length)};const{slider:t,type:o}=this.createSliderOverlay();this.progressbar=this.createProgressBar(),this.video=e,this.slider=t,this.type=o,this.segments=[],this.segmentsoverlay=document.createElement("div"),this.observer=new MutationObserver(this.onMutationCallback)}}},290:(e,t)=>{"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.SliderType=void 0,function(e){e.Chapters="chapters",e.Default="default"}(o||(t.SliderType=o={}))},951:function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.run=void 0;const r=o(281),s=o(761),i=o(204),a=o(308),l=o(141),c=o(52);t.run=()=>{const e=new a.VideoEventListener,t=e=>{var t;let o=null===(t=s.BAR_TYPES[e.category])||void 0===t?void 0:t.name;o||(console.warn("segment category not found in bar types",e),o=e.category),(0,r.showNotification)(`Skipping ${o}`)};e.addEventListener("ready",(()=>n(void 0,void 0,void 0,(function*(){const o=e.video,r=new l.SliderOverlay({video:o}),s=new c.SponsorblockSkipper({video:o,onSkipSegment:t});e.addEventListener("playing",(()=>n(void 0,void 0,void 0,(function*(){const e=(0,i.getVideoId)();if(!e)throw Error("videoID not found");console.log("watch video",e);const t=yield(0,i.fetchSegments)(e);s.setSegments(t),r.rebuild(t)})))),e.addEventListener("finished",(()=>{const e=(0,i.getVideoId)();s.setSegments([]),r.unmount(),console.log("close video",e)})),r.mount()})))),e.addEventListener("error",(e=>{console.error("VideoEventListener emited error",e)}))}},204:function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}l((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchSegments=t.getVideoId=void 0;const s=r(o(709)),i=o(761);t.getVideoId=()=>new URL(location.hash.substring(1),location.href).searchParams.get("v"),t.fetchSegments=e=>n(void 0,void 0,void 0,(function*(){var t;const o=null===(t=(0,s.default)(e))||void 0===t?void 0:t.substring(0,4),n=["sponsor","intro","outro","interaction","selfpromo","music_offtopic"];try{const t=yield fetch(`${i.SPONSOR_BLOCK_API}/skipSegments/${o}?categories=${encodeURIComponent(JSON.stringify(n))}`),r=yield t.json(),s=r.find((t=>t.videoID===e));return s&&s.segments&&s.segments.length?(console.info(e,"Got it:",s),s.segments):(console.info(e,"No segments found.",r),[])}catch(t){return console.warn(e,"fetchSegments error",t),[]}}))},308:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VideoEventListener=void 0;const r=n(o(913));class s extends r.default{constructor(){super(),this.waitToVideo=()=>new Promise(((e,t)=>{const o=document.querySelector("body");o.classList.contains("WEB_PAGE_TYPE_WATCH")&&(console.log("VideoEventListener.waitToVideo(): already watch",o),e());const n=new MutationObserver(((t,o)=>{var r,s;for(const o of t){const t=o.target.classList;t.contains("WEB_PAGE_TYPE_WATCH")&&(null===(r=o.oldValue)||void 0===r?void 0:r.includes("WEB_PAGE_TYPE_BROWSE"))&&(console.log("VideoEventListener.waitToVideo(): Режим воспроизведения"),n.disconnect(),e()),t.contains("WEB_PAGE_TYPE_BROWSE")&&(null===(s=o.oldValue)||void 0===s?void 0:s.includes("WEB_PAGE_TYPE_WATCH"))&&console.log("VideoEventListener.waitToVideo(): Выход из режима воспроизведения"),"class"===o.attributeName&&"attributes"===o.type&&t.contains("WEB_PAGE_TYPE_BROWSE")&&null===o.oldValue&&console.log("VideoEventListener.waitToVideo(): Первая загрузка страницы")}}));n.observe(o,{attributes:!0,attributeOldValue:!0,attributeFilter:["class"]})})),this.onMutationCallback=e=>{var t,o;for(const n of e){const e=!(null===(t=n.target.src)||void 0===t?void 0:t.length),r=["src"===n.attributeName,null===n.oldValue,!e],s=["src"===n.attributeName,!!(null===(o=n.oldValue)||void 0===o?void 0:o.length),e];if(r.every(Boolean)){const e=new Event("playing");this.dispatchEvent(e)}else if(s.every(Boolean)){const e=new Event("finished");this.dispatchEvent(e)}else console.warn("VideoEventListener.onMutationCallback():"),console.log("mutation:",n)}},this.waitToVideo().then((()=>{const e=document.querySelector("video");if(!e)throw new Error("video element not found");this.video=e,this.observer=new MutationObserver(this.onMutationCallback),this.observer.observe(this.video,{attributeFilter:["src"],attributeOldValue:!0,attributes:!0}),this.dispatchEvent(new Event("ready"))}))}}t.VideoEventListener=s},281:(e,t,o)=>{"use strict";o.r(t),o.d(t,{showNotification:()=>n});const n=window.sendUiNotifyMessage;setTimeout((()=>{n("Press [ctrl+s] to open YTAF configuration screen")}),2e3)},913:e=>{var t={};try{t.EventTarget=(new EventTarget).constructor}catch(e){!function(e,o){var n=e.create,r=e.defineProperty,s=i.prototype;function i(){"use strict";o.set(this,n(null))}function a(e,t,o){r(e,t,{configurable:!0,writable:!0,value:o})}function l(e){var t=e.options;return t&&t.once&&e.target.removeEventListener(this.type,e.listener),"function"==typeof e.listener?e.listener.call(e.target,this):e.listener.handleEvent(this),this._stopImmediatePropagationFlag}a(s,"addEventListener",(function(e,t,n){for(var r=o.get(this),s=r[e]||(r[e]=[]),i=0,a=s.length;i<a;i++)if(s[i].listener===t)return;s.push({target:this,listener:t,options:n})})),a(s,"dispatchEvent",(function(e){var t=o.get(this)[e.type];return t&&(a(e,"target",this),a(e,"currentTarget",this),t.slice(0).some(l,e),delete e.currentTarget,delete e.target),!0})),a(s,"removeEventListener",(function(e,t){for(var n=o.get(this),r=n[e]||(n[e]=[]),s=0,i=r.length;s<i;s++)if(r[s].listener===t)return void r.splice(s,1)})),t.EventTarget=i}(Object,new WeakMap)}e.exports=t.EventTarget}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,o),s.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=o(269);const t={enableAdBlock:!0,enableSponsorBlock:!0,enableSponsorBlockSponsor:!0,enableSponsorBlockIntro:!0,enableSponsorBlockOutro:!0,enableSponsorBlockInteraction:!0,enableSponsorBlockSelfPromo:!0,enableSponsorBlockMusicOfftopic:!0};let n;try{n=JSON.parse(window.localStorage["ytaf-configuration"])}catch(e){console.warn("Config read failed:",e),n=t}function r(e){return void 0===n[e]&&(console.warn("Populating key",e,"with default value",t[e]),n[e]=t[e]),n[e]}const s=JSON.parse;JSON.parse=function(){const e=s.apply(this,arguments);return e.adPlacements&&r("enableAdBlock")&&(e.adPlacements=[]),e?.contents?.tvBrowseRenderer?.content?.tvSurfaceContentRenderer?.content?.sectionListRenderer?.contents&&r("enableAdBlock")&&(e.contents.tvBrowseRenderer.content.tvSurfaceContentRenderer.content.sectionListRenderer.contents=e.contents.tvBrowseRenderer.content.tvSurfaceContentRenderer.content.sectionListRenderer.contents.filter((e=>!e.tvMastheadRenderer))),e},o(281),(async()=>{(0,e.K)();const t=await async function(e,t,o){return new Promise(((o,n)=>{const r=new MutationObserver((e=>{for(const n of e)switch(n.type){case"attributes":if(t(n.target))return r.disconnect(),void o(n.target);break;case"childList":for(const e of n.addedNodes)if(t(e))return r.disconnect(),void o(e)}}));r.observe(e,{subtree:!0,attributes:!0,childList:!0})}))}(document.body,(e=>e instanceof HTMLVideoElement));new MutationObserver((()=>{const e=t.style,o=`${window.innerWidth}px`,n=`${window.innerHeight}px`,r=e.top===`-${window.innerHeight}px`?e.top:"0px";e.width!==o&&(e.width=o),e.height!==n&&(e.height=n),"0px"!==e.left&&(e.left="0px"),e.top!==r&&(e.top=r)})).observe(t,{attributes:!0,attributeFilter:["style"]})})()})()})();